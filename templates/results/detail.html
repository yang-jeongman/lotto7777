{% extends "base.html" %}
{% load lotto_tags humanize %}

{% block title %}제{{ draw.draw_no }}회 로또 당첨번호 - L7*7{% endblock %}

{% block extra_css %}
<meta name="description" content="로또 6/45 제{{ draw.draw_no }}회 당첨번호: {% for n in draw.numbers %}{{ n }}{% if not forloop.last %}, {% endif %}{% endfor %} + 보너스 {{ draw.bonus_number }}. {{ draw.draw_date }} 추첨.">
{% endblock %}

{% block content %}
<section class="pt-24 pb-16 px-4 bg-gradient-to-b from-lotto-purple-dark to-lotto-blue-dark min-h-screen">
    <div class="max-w-lg mx-auto">

        <!-- 회차 네비게이션 -->
        <div class="flex items-center justify-between mb-6">
            {% if prev_draw %}
            <a href="{% url 'results:detail' prev_draw.draw_no %}"
               class="px-3 py-2 rounded-lg bg-white/10 text-sm text-white/60 hover:bg-white/20 transition-colors">
                &lsaquo; 제{{ prev_draw.draw_no }}회
            </a>
            {% else %}
            <span></span>
            {% endif %}

            <a href="{% url 'results:list' %}" class="text-sm text-white/40 hover:text-lotto-gold transition-colors">
                전체 목록
            </a>

            {% if next_draw %}
            <a href="{% url 'results:detail' next_draw.draw_no %}"
               class="px-3 py-2 rounded-lg bg-white/10 text-sm text-white/60 hover:bg-white/20 transition-colors">
                제{{ next_draw.draw_no }}회 &rsaquo;
            </a>
            {% else %}
            <span></span>
            {% endif %}
        </div>

        <!-- 메인 카드 -->
        <div class="glass-card rounded-2xl p-6 mb-6">
            <div class="text-center mb-6">
                <div class="inline-block px-4 py-1 rounded-full bg-lotto-gold/20 mb-3">
                    <span class="text-lotto-gold font-bold">제{{ draw.draw_no }}회</span>
                </div>
                <p class="text-white/50 text-sm">{{ draw.draw_date }} 추첨</p>
            </div>

            <!-- 당첨 번호 -->
            <div class="flex justify-center items-center gap-2.5 mb-8">
                {% for num in draw.numbers %}
                <div class="ball-enter w-14 h-14 rounded-full flex items-center justify-center font-bold text-xl shadow-lg"
                     style="background: {{ num|ball_color }}; color: {{ num|ball_text_color }}; animation-delay: {{ forloop.counter0 }}00ms;">
                    {{ num }}
                </div>
                {% endfor %}
                <span class="text-2xl text-white/40 mx-1">+</span>
                <div class="ball-enter w-14 h-14 rounded-full flex items-center justify-center font-bold text-xl shadow-lg ring-2 ring-lotto-gold"
                     style="background: {{ draw.bonus_number|ball_color }}; color: {{ draw.bonus_number|ball_text_color }}; animation-delay: 600ms;">
                    {{ draw.bonus_number }}
                </div>
            </div>

            <!-- 당첨 정보 -->
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white/5 rounded-xl p-4 text-center">
                    <div class="text-white/40 text-xs mb-1">1등 당첨금</div>
                    <div class="text-lotto-gold font-bold text-lg">
                        {% if draw.first_prize_amount %}
                        {{ draw.first_prize_amount|intcomma_kr }}원
                        {% else %}
                        -
                        {% endif %}
                    </div>
                </div>
                <div class="bg-white/5 rounded-xl p-4 text-center">
                    <div class="text-white/40 text-xs mb-1">1등 당첨자</div>
                    <div class="text-white font-bold text-lg">
                        {{ draw.first_prize_winners }}명
                    </div>
                </div>
                {% if draw.second_prize_amount %}
                <div class="bg-white/5 rounded-xl p-4 text-center">
                    <div class="text-white/40 text-xs mb-1">2등 당첨금</div>
                    <div class="text-white/80 font-bold">
                        {{ draw.second_prize_amount|intcomma_kr }}원
                    </div>
                </div>
                <div class="bg-white/5 rounded-xl p-4 text-center">
                    <div class="text-white/40 text-xs mb-1">2등 당첨자</div>
                    <div class="text-white/80 font-bold">
                        {{ draw.second_prize_winners }}명
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- 번호 분석 -->
        <div class="glass-card rounded-2xl p-6 mb-6">
            <h3 class="font-bold text-sm text-white/70 mb-4">번호 분석</h3>
            <div class="grid grid-cols-3 gap-3 text-center text-sm">
                <div class="bg-white/5 rounded-lg p-3">
                    <div class="text-white/40 text-xs">번호 합</div>
                    <div class="text-white font-bold mt-1" id="num-sum">-</div>
                </div>
                <div class="bg-white/5 rounded-lg p-3">
                    <div class="text-white/40 text-xs">홀짝 비율</div>
                    <div class="text-white font-bold mt-1" id="odd-even">-</div>
                </div>
                <div class="bg-white/5 rounded-lg p-3">
                    <div class="text-white/40 text-xs">구간 분포</div>
                    <div class="text-white font-bold mt-1" id="range-dist">-</div>
                </div>
            </div>
        </div>

        <!-- CTA -->
        <div class="text-center">
            <a href="{% url 'results:list' %}"
               class="inline-block px-6 py-3 bg-white/10 border border-white/20 rounded-full text-sm text-white/60 hover:bg-white/20 transition-all">
                전체 당첨번호 보기
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// 번호 분석
const numbers = [{% for n in draw.numbers %}{{ n }}{% if not forloop.last %},{% endif %}{% endfor %}];

// 합계
document.getElementById('num-sum').textContent = numbers.reduce((a, b) => a + b, 0);

// 홀짝
const odds = numbers.filter(n => n % 2 === 1).length;
const evens = 6 - odds;
document.getElementById('odd-even').textContent = `${odds}:${evens}`;

// 구간 분포 (1-10, 11-20, 21-30, 31-40, 41-45)
const ranges = [0, 0, 0, 0, 0];
numbers.forEach(n => {
    if (n <= 10) ranges[0]++;
    else if (n <= 20) ranges[1]++;
    else if (n <= 30) ranges[2]++;
    else if (n <= 40) ranges[3]++;
    else ranges[4]++;
});
document.getElementById('range-dist').textContent = ranges.filter(r => r > 0).length + '구간';
</script>
{% endblock %}
