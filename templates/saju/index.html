{% extends "base.html" %}
{% load lotto_tags %}

{% block title %}ì‚¬ì£¼íŒ”ì ë§ì¶¤ í–‰ìš´ë²ˆí˜¸ - L7*7{% endblock %}

{% block content %}

<!-- ============================================ -->
<!-- HERO: ì‚¬ì£¼íŒ”ì ì†Œê°œ                           -->
<!-- ============================================ -->
<section class="relative min-h-[50vh] flex flex-col items-center justify-center bg-gradient-to-br from-indigo-950 via-purple-900 to-lotto-blue px-4 pt-20 pb-12 overflow-hidden">
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="particle particle-1"></div>
        <div class="particle particle-3"></div>
        <div class="particle particle-5"></div>
    </div>
    <div class="relative z-10 text-center max-w-lg mx-auto">
        <div class="text-6xl mb-4">ğŸ§¿</div>
        <h1 class="text-3xl font-black mb-2">
            <span class="text-lotto-gold">ì‚¬ì£¼íŒ”ì</span> ë§ì¶¤ í–‰ìš´ë²ˆí˜¸
        </h1>
        <p class="text-white/50 text-sm leading-relaxed">
            ìƒë…„ì›”ì¼ì‹œë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ì‚¬ì£¼ë¥¼ ë¶„ì„í•˜ì—¬<br>
            ë‚˜ì—ê²Œ ë”± ë§ëŠ” ë¡œë˜ ë²ˆí˜¸ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤
        </p>
    </div>
</section>

<!-- ============================================ -->
<!-- ì…ë ¥ í¼                                       -->
<!-- ============================================ -->
<section id="saju-form-section" class="py-12 px-4 bg-lotto-blue-dark">
    <div class="max-w-md mx-auto">
        <div class="glass-card rounded-2xl p-6">
            <h2 class="text-lg font-bold text-center mb-6">ìƒë…„ì›”ì¼ì‹œ ì…ë ¥</h2>

            <form id="saju-form" class="space-y-5">
                {% csrf_token %}

                <!-- ìƒë…„ì›”ì¼ -->
                <div>
                    <label class="block text-sm text-white/60 mb-2">ìƒë…„ì›”ì¼</label>
                    <div class="grid grid-cols-3 gap-2">
                        <div>
                            <select id="birth-year" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2.5 text-white text-sm focus:border-lotto-gold focus:outline-none">
                                <option value="" class="bg-gray-800">ë…„ë„</option>
                            </select>
                        </div>
                        <div>
                            <select id="birth-month" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2.5 text-white text-sm focus:border-lotto-gold focus:outline-none">
                                <option value="" class="bg-gray-800">ì›”</option>
                            </select>
                        </div>
                        <div>
                            <select id="birth-day" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2.5 text-white text-sm focus:border-lotto-gold focus:outline-none">
                                <option value="" class="bg-gray-800">ì¼</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- íƒœì–´ë‚œ ì‹œê°„ -->
                <div>
                    <label class="block text-sm text-white/60 mb-2">íƒœì–´ë‚œ ì‹œê°„ <span class="text-white/30">(ì„ íƒ)</span></label>
                    <div class="grid grid-cols-2 gap-2">
                        <select id="birth-hour" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2.5 text-white text-sm focus:border-lotto-gold focus:outline-none">
                            <option value="" class="bg-gray-800">ì‹œ</option>
                            <option value="-1" class="bg-gray-800">ëª¨ë¦„</option>
                        </select>
                        <select id="birth-minute" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2.5 text-white text-sm focus:border-lotto-gold focus:outline-none">
                            <option value="0" class="bg-gray-800">0ë¶„</option>
                            <option value="15" class="bg-gray-800">15ë¶„</option>
                            <option value="30" class="bg-gray-800">30ë¶„</option>
                            <option value="45" class="bg-gray-800">45ë¶„</option>
                        </select>
                    </div>
                </div>

                <!-- ì„±ë³„ -->
                <div>
                    <label class="block text-sm text-white/60 mb-2">ì„±ë³„</label>
                    <div class="grid grid-cols-2 gap-2">
                        <label class="cursor-pointer">
                            <input type="radio" name="gender" value="M" class="hidden peer" checked>
                            <div class="peer-checked:bg-lotto-gold peer-checked:text-lotto-blue-dark bg-white/10 border border-white/20 rounded-lg py-2.5 text-center text-sm font-medium transition-all peer-checked:border-lotto-gold">
                                ë‚¨ì„±
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="gender" value="F" class="hidden peer">
                            <div class="peer-checked:bg-lotto-gold peer-checked:text-lotto-blue-dark bg-white/10 border border-white/20 rounded-lg py-2.5 text-center text-sm font-medium transition-all peer-checked:border-lotto-gold">
                                ì—¬ì„±
                            </div>
                        </label>
                    </div>
                </div>

                <!-- ì œì¶œ ë²„íŠ¼ -->
                <button type="submit" id="submit-btn" class="w-full py-3.5 bg-lotto-gold text-lotto-blue-dark font-bold rounded-full text-lg shadow-lg shadow-lotto-gold/30 hover:bg-lotto-gold-light transition-all hover:scale-[1.02] active:scale-95">
                    ë‚˜ì˜ í–‰ìš´ë²ˆí˜¸ í™•ì¸í•˜ê¸°
                </button>
            </form>
        </div>

        <p class="text-center text-white/20 text-xs mt-4">
            ì…ë ¥ ì •ë³´ëŠ” ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, ë²ˆí˜¸ ì¶”ì²œì—ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤
        </p>
    </div>
</section>

<!-- ============================================ -->
<!-- ë¡œë”© ìƒíƒœ                                     -->
<!-- ============================================ -->
<section id="loading-section" class="hidden py-20 px-4 bg-lotto-blue-dark">
    <div class="max-w-md mx-auto text-center">
        <div class="text-5xl mb-4 animate-pulse">ğŸ”®</div>
        <h3 class="text-xl font-bold mb-2">ì‚¬ì£¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h3>
        <p class="text-white/40 text-sm">AIê°€ ë‹¹ì‹ ì˜ ì‚¬ì£¼íŒ”ìë¥¼ ì½ê³  ìˆìŠµë‹ˆë‹¤</p>
        <div class="mt-6 flex justify-center gap-1">
            <div class="w-2 h-2 bg-lotto-gold rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
            <div class="w-2 h-2 bg-lotto-gold rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
            <div class="w-2 h-2 bg-lotto-gold rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- ê²°ê³¼ í‘œì‹œ                                     -->
<!-- ============================================ -->
<section id="result-section" class="hidden py-12 px-4 bg-gradient-to-b from-lotto-blue-dark to-indigo-950">
    <div class="max-w-lg mx-auto space-y-6">

        <!-- ì‚¬ì£¼ ì°¨íŠ¸ -->
        <div class="glass-card rounded-2xl p-5">
            <h3 class="text-center text-sm text-white/50 mb-4">ğŸ“œ ë‚˜ì˜ ì‚¬ì£¼íŒ”ì</h3>
            <div class="grid grid-cols-4 gap-2 text-center" id="pillar-chart">
                <!-- í—¤ë” -->
                <div class="text-xs text-white/40 pb-1">ì‹œì£¼</div>
                <div class="text-xs text-white/40 pb-1">ì¼ì£¼</div>
                <div class="text-xs text-white/40 pb-1">ì›”ì£¼</div>
                <div class="text-xs text-white/40 pb-1">ë…„ì£¼</div>
                <!-- ì²œê°„ -->
                <div id="stem-hour" class="text-2xl font-bold py-2 rounded-t-lg bg-white/5">-</div>
                <div id="stem-day" class="text-2xl font-bold py-2 rounded-t-lg bg-white/5">-</div>
                <div id="stem-month" class="text-2xl font-bold py-2 rounded-t-lg bg-white/5">-</div>
                <div id="stem-year" class="text-2xl font-bold py-2 rounded-t-lg bg-white/5">-</div>
                <!-- ì§€ì§€ -->
                <div id="branch-hour" class="text-2xl font-bold py-2 bg-white/5">-</div>
                <div id="branch-day" class="text-2xl font-bold py-2 bg-white/5">-</div>
                <div id="branch-month" class="text-2xl font-bold py-2 bg-white/5">-</div>
                <div id="branch-year" class="text-2xl font-bold py-2 bg-white/5">-</div>
                <!-- ì‹­ì‹  -->
                <div id="god-hour" class="text-xs text-white/50 pt-1 rounded-b-lg bg-white/5 pb-2">-</div>
                <div id="god-day" class="text-xs text-lotto-gold pt-1 rounded-b-lg bg-white/5 pb-2">ì¼ê°„</div>
                <div id="god-month" class="text-xs text-white/50 pt-1 rounded-b-lg bg-white/5 pb-2">-</div>
                <div id="god-year" class="text-xs text-white/50 pt-1 rounded-b-lg bg-white/5 pb-2">-</div>
            </div>

            <!-- ì˜¤í–‰ ë¶„í¬ ë°” -->
            <div class="mt-4 pt-4 border-t border-white/10">
                <p class="text-xs text-white/40 mb-2">ì˜¤í–‰ ë¶„í¬</p>
                <div class="flex gap-1" id="element-bars">
                    <!-- JSì—ì„œ ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>

        <!-- AI í•´ì„ -->
        <div class="glass-card rounded-2xl p-5">
            <h3 class="text-sm text-white/50 mb-1">ğŸ”® AI ìš´ì„¸ í•´ì„</h3>
            <p id="result-summary" class="text-lotto-gold font-semibold text-sm mb-3"></p>
            <p id="result-fortune" class="text-white/80 text-sm leading-relaxed mb-3"></p>
            <div class="bg-white/5 rounded-xl p-3">
                <p class="text-xs text-white/40 mb-1">ì˜¤í–‰ ë¶„ì„</p>
                <p id="result-element-analysis" class="text-white/70 text-xs leading-relaxed"></p>
            </div>
        </div>

        <!-- ë§ì¶¤í˜• ë¡œë˜ ë²ˆí˜¸ -->
        <div class="space-y-3" id="lucky-numbers-container">
            <!-- JSì—ì„œ ë™ì  ìƒì„± -->
        </div>

        <!-- í–‰ìš´ ë©”ì‹œì§€ -->
        <div class="glass-card rounded-2xl p-5 text-center">
            <div class="text-3xl mb-2">ğŸ€</div>
            <p id="result-message" class="text-lg font-medium text-white/80 italic"></p>
        </div>

        <!-- ë‹¤ì‹œ í•˜ê¸° -->
        <div class="text-center pt-4">
            <button onclick="resetForm()" class="px-6 py-2.5 bg-white/10 border border-white/20 rounded-full text-sm text-white/60 hover:bg-white/20 transition-all">
                ë‹¤ì‹œ ë¶„ì„í•˜ê¸°
            </button>
            <a href="/" class="ml-3 px-6 py-2.5 bg-white/5 border border-white/10 rounded-full text-sm text-white/40 hover:bg-white/10 transition-all inline-block">
                í™ˆìœ¼ë¡œ
            </a>
        </div>
    </div>
</section>

<!-- ì—ëŸ¬ í‘œì‹œ -->
<section id="error-section" class="hidden py-20 px-4 bg-lotto-blue-dark">
    <div class="max-w-md mx-auto text-center">
        <div class="text-5xl mb-4">âš ï¸</div>
        <h3 class="text-xl font-bold mb-2">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
        <p id="error-message" class="text-white/50 text-sm mb-6"></p>
        <button onclick="resetForm()" class="px-6 py-2.5 bg-lotto-gold text-lotto-blue-dark font-semibold rounded-full text-sm">
            ë‹¤ì‹œ ì‹œë„í•˜ê¸°
        </button>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script type="module">
import { calculateSaju } from 'https://esm.sh/@orrery/core@0.3.0/saju';

// ============================================
// ì˜¤í–‰ ìƒ‰ìƒ ë§¤í•‘
// ============================================
const ELEMENT_COLORS = {
    'ëª©': { bg: '#22c55e', text: 'æœ¨' },
    'í™”': { bg: '#ef4444', text: 'ç«' },
    'í† ': { bg: '#eab308', text: 'åœŸ' },
    'ê¸ˆ': { bg: '#a1a1aa', text: 'é‡‘' },
    'ìˆ˜': { bg: '#3b82f6', text: 'æ°´' },
    'Wood': { bg: '#22c55e', text: 'æœ¨' },
    'Fire': { bg: '#ef4444', text: 'ç«' },
    'Earth': { bg: '#eab308', text: 'åœŸ' },
    'Metal': { bg: '#a1a1aa', text: 'é‡‘' },
    'Water': { bg: '#3b82f6', text: 'æ°´' },
};

// ============================================
// í¼ ì˜µì…˜ ìƒì„±
// ============================================
function populateSelects() {
    const yearSel = document.getElementById('birth-year');
    const monthSel = document.getElementById('birth-month');
    const daySel = document.getElementById('birth-day');
    const hourSel = document.getElementById('birth-hour');

    const currentYear = new Date().getFullYear();
    for (let y = currentYear - 10; y >= 1940; y--) {
        const opt = document.createElement('option');
        opt.value = y;
        opt.textContent = y + 'ë…„';
        opt.className = 'bg-gray-800';
        yearSel.appendChild(opt);
    }
    for (let m = 1; m <= 12; m++) {
        const opt = document.createElement('option');
        opt.value = m;
        opt.textContent = m + 'ì›”';
        opt.className = 'bg-gray-800';
        monthSel.appendChild(opt);
    }
    for (let d = 1; d <= 31; d++) {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d + 'ì¼';
        opt.className = 'bg-gray-800';
        daySel.appendChild(opt);
    }
    for (let h = 0; h <= 23; h++) {
        const opt = document.createElement('option');
        opt.value = h;
        opt.textContent = h + 'ì‹œ';
        opt.className = 'bg-gray-800';
        hourSel.appendChild(opt);
    }
}
populateSelects();

// ============================================
// CSRF í† í°
// ============================================
function getCSRFToken() {
    const el = document.querySelector('[name=csrfmiddlewaretoken]');
    return el ? el.value : '';
}

// ============================================
// ë¡œë˜ ë³¼ ìƒ‰ìƒ
// ============================================
function getBallColor(num) {
    if (num <= 10) return '#FFC107';
    if (num <= 20) return '#2196F3';
    if (num <= 30) return '#F44336';
    if (num <= 40) return '#9E9E9E';
    return '#4CAF50';
}
function getBallTextColor(num) {
    return num <= 10 ? '#333' : '#fff';
}

// ============================================
// ì„¹ì…˜ ì „í™˜
// ============================================
function showSection(sectionId) {
    ['saju-form-section', 'loading-section', 'result-section', 'error-section'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
    });
    document.getElementById(sectionId).classList.remove('hidden');
    if (sectionId !== 'saju-form-section') {
        document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
    }
}

// ============================================
// í¼ ì œì¶œ
// ============================================
document.getElementById('saju-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const year = parseInt(document.getElementById('birth-year').value);
    const month = parseInt(document.getElementById('birth-month').value);
    const day = parseInt(document.getElementById('birth-day').value);
    const hourVal = document.getElementById('birth-hour').value;
    const minute = parseInt(document.getElementById('birth-minute').value) || 0;
    const gender = document.querySelector('input[name="gender"]:checked').value;

    if (!year || !month || !day) {
        alert('ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }

    const hour = (hourVal === '' || hourVal === '-1') ? null : parseInt(hourVal);

    showSection('loading-section');

    try {
        // 1. orreryë¡œ ì‚¬ì£¼ ê³„ì‚°
        const sajuInput = { year, month, day, gender };
        if (hour !== null) {
            sajuInput.hour = hour;
            sajuInput.minute = minute;
        }

        let sajuResult;
        try {
            sajuResult = calculateSaju(sajuInput);
        } catch (calcErr) {
            console.error('ì‚¬ì£¼ ê³„ì‚° ì˜¤ë¥˜:', calcErr);
            throw new Error('ì‚¬ì£¼ ê³„ì‚°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì…ë ¥ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }

        // 2. ì‚¬ì£¼ ê²°ê³¼ì—ì„œ ë°ì´í„° ì¶”ì¶œ
        const pillars = extractPillars(sajuResult);
        const tenGods = extractTenGods(sajuResult);
        const elements = countElements(sajuResult);

        // 3. ì‚¬ì£¼ ì°¨íŠ¸ UI ì¦‰ì‹œ í‘œì‹œ
        displayPillarChart(sajuResult, pillars, tenGods, elements);

        // 4. AI í•´ì„ ìš”ì²­
        const response = await fetch('/saju/api/interpret/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken(),
            },
            body: JSON.stringify({
                pillars,
                birth_info: { year, month, day, hour, minute, gender },
                ten_gods: tenGods,
                elements,
            }),
        });

        if (!response.ok) {
            const err = await response.json();
            throw new Error(err.error || 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }

        const result = await response.json();
        displayResults(result);
        showSection('result-section');

    } catch (err) {
        document.getElementById('error-message').textContent = err.message;
        showSection('error-section');
    }
});

// ============================================
// ì‚¬ì£¼ ê²°ê³¼ ë°ì´í„° ì¶”ì¶œ
// ============================================
function extractPillars(result) {
    const pillars = {};
    const keys = ['year', 'month', 'day', 'hour'];
    const pillarData = result.pillars || result;

    keys.forEach(key => {
        const p = pillarData[key] || {};
        pillars[key] = {
            stem: p.stem || p.heavenlyStem || p.gan || '?',
            branch: p.branch || p.earthlyBranch || p.ji || '?',
            stemHanja: p.stemHanja || p.ganHanja || '',
            branchHanja: p.branchHanja || p.jiHanja || '',
            element: p.element || p.stemElement || '',
        };
    });
    return pillars;
}

function extractTenGods(result) {
    const gods = {};
    const keys = ['year', 'month', 'day', 'hour'];
    const tenGodsData = result.tenGods || result.sipsin || {};

    keys.forEach(key => {
        gods[key] = tenGodsData[key] || '';
    });
    return gods;
}

function countElements(result) {
    const counts = { 'ëª©': 0, 'í™”': 0, 'í† ': 0, 'ê¸ˆ': 0, 'ìˆ˜': 0 };
    const ELEMENT_MAP = {
        'Wood': 'ëª©', 'Fire': 'í™”', 'Earth': 'í† ', 'Metal': 'ê¸ˆ', 'Water': 'ìˆ˜',
        'ëª©': 'ëª©', 'í™”': 'í™”', 'í† ': 'í† ', 'ê¸ˆ': 'ê¸ˆ', 'ìˆ˜': 'ìˆ˜',
    };
    const pillars = result.pillars || result;
    ['year', 'month', 'day', 'hour'].forEach(key => {
        const p = pillars[key];
        if (!p) return;
        const stemElem = p.stemElement || p.element || '';
        const branchElem = p.branchElement || '';
        if (ELEMENT_MAP[stemElem]) counts[ELEMENT_MAP[stemElem]]++;
        if (ELEMENT_MAP[branchElem]) counts[ELEMENT_MAP[branchElem]]++;
    });
    return counts;
}

// ============================================
// ì‚¬ì£¼ ì°¨íŠ¸ í‘œì‹œ
// ============================================
function displayPillarChart(sajuResult, pillars, tenGods, elements) {
    ['hour', 'day', 'month', 'year'].forEach(key => {
        const p = pillars[key];
        const stemEl = document.getElementById(`stem-${key}`);
        const branchEl = document.getElementById(`branch-${key}`);
        const godEl = document.getElementById(`god-${key}`);

        const stemText = p.stemHanja || p.stem;
        const branchText = p.branchHanja || p.branch;

        stemEl.textContent = stemText;
        branchEl.textContent = branchText;

        // ì˜¤í–‰ ìƒ‰ìƒ ì ìš©
        const elemColor = ELEMENT_COLORS[p.element] || {};
        if (elemColor.bg) {
            stemEl.style.color = elemColor.bg;
        }

        if (key !== 'day' && tenGods[key]) {
            godEl.textContent = tenGods[key];
        }
    });

    // ì˜¤í–‰ ë¶„í¬ ë°”
    const barsEl = document.getElementById('element-bars');
    barsEl.innerHTML = '';
    const total = Object.values(elements).reduce((a, b) => a + b, 0) || 1;

    Object.entries(elements).forEach(([elem, count]) => {
        const pct = Math.max((count / total) * 100, 8);
        const color = ELEMENT_COLORS[elem] || {};
        const bar = document.createElement('div');
        bar.className = 'rounded-full text-center text-[10px] font-bold py-1 transition-all';
        bar.style.width = pct + '%';
        bar.style.backgroundColor = color.bg || '#666';
        bar.style.color = '#fff';
        bar.textContent = (color.text || elem) + count;
        barsEl.appendChild(bar);
    });
}

// ============================================
// AI ê²°ê³¼ í‘œì‹œ
// ============================================
function displayResults(result) {
    const interp = result.interpretation || {};
    document.getElementById('result-summary').textContent = interp.summary || '';
    document.getElementById('result-fortune').textContent = interp.fortune || '';
    document.getElementById('result-element-analysis').textContent = interp.element_analysis || '';
    document.getElementById('result-message').textContent = result.lucky_message || '';

    // ë¡œë˜ ë²ˆí˜¸ ì¹´ë“œ
    const container = document.getElementById('lucky-numbers-container');
    container.innerHTML = '';

    const luckyNums = result.lucky_numbers || [];
    luckyNums.forEach((set, idx) => {
        const card = document.createElement('div');
        card.className = 'glass-card rounded-2xl p-5';
        card.innerHTML = `
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-sm font-semibold text-white/80">ğŸ± ${set.set_name || 'ì„¸íŠ¸ ' + (idx + 1)}</h3>
            </div>
            <div class="flex justify-center gap-2 mb-3">
                ${(set.numbers || []).map(num => `
                    <div class="ball-enter w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-md"
                         style="background: ${getBallColor(num)}; color: ${getBallTextColor(num)};">
                        ${num}
                    </div>
                `).join('')}
            </div>
            <p class="text-white/40 text-xs text-center">${set.reason || ''}</p>
        `;
        container.appendChild(card);
    });
}

// ============================================
// ë¦¬ì…‹
// ============================================
window.resetForm = function() {
    showSection('saju-form-section');
    window.scrollTo({ top: 0, behavior: 'smooth' });
};

// ============================================
// ë„¤ë¹„ë°” ìŠ¤í¬ë¡¤ íš¨ê³¼
// ============================================
const navbar = document.getElementById('navbar');
window.addEventListener('scroll', () => {
    if (window.scrollY > 80) {
        navbar.classList.add('navbar-scrolled');
    } else {
        navbar.classList.remove('navbar-scrolled');
    }
});
</script>
{% endblock %}
