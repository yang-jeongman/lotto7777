{% extends "base.html" %}
{% load lotto_tags humanize %}

{% block content %}

<!-- ============================================ -->
<!-- SECTION 1: Hero / í˜„ì¬ íšŒì°¨ ë‹¹ì²¨ ê²°ê³¼        -->
<!-- ============================================ -->
<section id="hero" class="relative min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-lotto-purple-dark via-lotto-purple to-lotto-blue px-4 overflow-hidden">
    <!-- íŒŒí‹°í´ ë°°ê²½ -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="particle particle-1"></div>
        <div class="particle particle-2"></div>
        <div class="particle particle-3"></div>
        <div class="particle particle-4"></div>
        <div class="particle particle-5"></div>
        <div class="particle particle-6"></div>
    </div>

    <div class="relative z-10 text-center max-w-lg mx-auto pt-16">
        <!-- ë¡œê³  -->
        <div class="mb-6">
            <span class="text-5xl font-black tracking-tight">
                <span class="text-lotto-gold">L7</span><span class="text-white/60">*</span><span class="text-lotto-gold">7</span>
            </span>
            <p class="text-white/50 text-sm mt-1">í–‰ìš´ì„ í•¨ê»˜ ë§Œë“œëŠ” ì»¤ë®¤ë‹ˆí‹°</p>
        </div>

        <!-- íšŒì°¨ ì •ë³´ -->
        <div class="inline-block px-4 py-1 rounded-full bg-white/10 border border-white/20 mb-4">
            <span class="text-lotto-gold text-sm font-semibold">ì œ{{ current_draw.draw_no }}íšŒ ë‹¹ì²¨ê²°ê³¼</span>
            <span class="text-white/40 text-xs ml-2">{{ current_draw.draw_date }}</span>
        </div>

        <!-- ë‹¹ì²¨ ë²ˆí˜¸ -->
        <div class="flex justify-center items-center gap-2 my-6 flex-wrap">
            {% for num in current_draw.winning_numbers %}
            <div class="ball-enter w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg shadow-lg"
                 style="background: {{ num|ball_color }}; color: {{ num|ball_text_color }}; animation-delay: {{ forloop.counter0 }}00ms;">
                {{ num }}
            </div>
            {% endfor %}
            <span class="text-2xl text-white/40 mx-1">+</span>
            <div class="ball-enter w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg shadow-lg ring-2 ring-lotto-gold ring-offset-2 ring-offset-lotto-purple-dark"
                 style="background: {{ current_draw.bonus_number|ball_color }}; color: {{ current_draw.bonus_number|ball_text_color }}; animation-delay: 600ms;">
                {{ current_draw.bonus_number }}
            </div>
        </div>

        <!-- ë‹¹ì²¨ê¸ˆ -->
        <div class="mb-6">
            <p class="text-3xl font-bold text-lotto-gold-light">
                1ë“± {{ current_draw.first_prize|intcomma_kr }}ì›
            </p>
            <p class="text-white/50 text-sm mt-1">
                {{ current_draw.first_prize_winners }}ëª… ë‹¹ì²¨ &middot; ì´ íŒë§¤ {{ current_draw.total_sales|intcomma_kr }}ì›
            </p>
        </div>

        <!-- ì¹´ìš´íŠ¸ë‹¤ìš´ -->
        <div class="mb-8">
            <p class="text-white/40 text-xs mb-3">ë‹¤ìŒ ì¶”ì²¨ê¹Œì§€</p>
            <div class="flex justify-center gap-3" id="countdown">
                <div class="countdown-box rounded-xl px-3 py-2 min-w-[60px] text-center">
                    <div class="text-2xl font-bold text-lotto-gold" id="cd-days">0</div>
                    <div class="text-[10px] text-white/40">ì¼</div>
                </div>
                <div class="countdown-box rounded-xl px-3 py-2 min-w-[60px] text-center">
                    <div class="text-2xl font-bold text-lotto-gold" id="cd-hours">0</div>
                    <div class="text-[10px] text-white/40">ì‹œê°„</div>
                </div>
                <div class="countdown-box rounded-xl px-3 py-2 min-w-[60px] text-center">
                    <div class="text-2xl font-bold text-lotto-gold" id="cd-minutes">0</div>
                    <div class="text-[10px] text-white/40">ë¶„</div>
                </div>
                <div class="countdown-box rounded-xl px-3 py-2 min-w-[60px] text-center">
                    <div class="text-2xl font-bold text-lotto-gold" id="cd-seconds">0</div>
                    <div class="text-[10px] text-white/40">ì´ˆ</div>
                </div>
            </div>
        </div>

        <!-- CTA ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <a href="#ai-recommend" class="inline-block px-8 py-4 bg-lotto-gold text-lotto-blue-dark font-bold rounded-full text-lg shadow-lg shadow-lotto-gold/30 hover:bg-lotto-gold-light transition-all duration-300 hover:scale-105 active:scale-95">
                AI ì¶”ì²œë²ˆí˜¸ í™•ì¸í•˜ê¸°
            </a>
        </div>

        <!-- ì™¸ë¶€ ë§í¬ -->
        <div class="flex justify-center gap-4 mt-4">
            <a href="https://www.dhlottery.co.kr/lt645/result" target="_blank" rel="noopener"
               class="text-xs text-white/40 hover:text-lotto-gold transition-colors underline underline-offset-2">
                ê³µì‹ ë‹¹ì²¨ê²°ê³¼ í™•ì¸
            </a>
            <a href="https://www.dhlottery.co.kr/prchsplcsrch/home" target="_blank" rel="noopener"
               class="text-xs text-white/40 hover:text-lotto-gold transition-colors underline underline-offset-2">
                ë‹¹ì²¨ íŒë§¤ì  ì¡°íšŒ
            </a>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¡¤ ì¸ë””ì¼€ì´í„° -->
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
        <svg class="w-6 h-6 text-white/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
        </svg>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 2: AI ë²ˆí˜¸ ì¶”ì²œ                      -->
<!-- ============================================ -->
<section id="ai-recommend" class="py-16 px-4 bg-gradient-to-b from-lotto-blue-dark to-lotto-purple-dark/50">
    <div class="max-w-lg mx-auto section-fade">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold">
                <span class="text-lotto-gold">AI</span>ê°€ ë¶„ì„í•œ ì¶”ì²œ ë²ˆí˜¸
            </h2>
            <p class="text-white/40 text-sm mt-1">ë§¤ì£¼ í† ìš”ì¼ ìë™ ì—…ë°ì´íŠ¸</p>
        </div>

        <div class="space-y-4">
            {% for rec in ai_recommendations %}
            <div class="glass-card rounded-2xl p-5">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-sm font-semibold text-white/80">{{ rec.set_name }}</h3>
                    <span class="text-xs text-white/40">{{ rec.strategy }}</span>
                </div>

                <!-- ì¶”ì²œ ë²ˆí˜¸ -->
                <div class="flex justify-center gap-2 mb-4">
                    {% for num in rec.numbers %}
                    <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-md"
                         style="background: {{ num|ball_color }}; color: {{ num|ball_text_color }};">
                        {{ num }}
                    </div>
                    {% endfor %}
                </div>

                <!-- ì‹ ë¢°ë„ ë°” -->
                <div class="flex items-center gap-3">
                    <span class="text-xs text-white/40 whitespace-nowrap">ì‹ ë¢°ë„</span>
                    <div class="flex-1 h-2 bg-white/10 rounded-full overflow-hidden">
                        <div class="confidence-bar h-full rounded-full bg-gradient-to-r from-lotto-gold to-lotto-gold-light"
                             style="width: {{ rec.confidence }}%;"></div>
                    </div>
                    <span class="text-xs font-semibold text-lotto-gold">{{ rec.confidence }}%</span>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-6">
            <a href="{% url 'landing:more_recommendations' %}" class="text-sm text-lotto-gold hover:text-lotto-gold-light transition-colors">
                ë” ë§ì€ ì¶”ì²œ ë³´ê¸° &rarr;
            </a>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 3: ë²ˆí˜¸ë³„ ì¶œí˜„ ë¶„ì„ (Hot/Cold)       -->
<!-- ============================================ -->
<section id="analysis" class="py-16 px-4 bg-lotto-blue-dark">
    <div class="max-w-lg mx-auto section-fade">
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold">ë²ˆí˜¸ë³„ ì¶œí˜„ ë¶„ì„</h2>
            <p class="text-white/40 text-sm mt-1">ë¹¨ê°• = ë¹ˆì¶œ | íŒŒë‘ = ë¯¸ì¶œ</p>
        </div>

        <!-- ê¸°ê°„ íƒ­ -->
        <div class="flex justify-center gap-2 mb-6">
            <button class="tab-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-lotto-gold text-lotto-blue-dark" data-period="10" onclick="switchPeriod(10)">ìµœê·¼ 10íšŒ</button>
            <button class="tab-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-white/10 text-white/60 hover:bg-white/20" data-period="30" onclick="switchPeriod(30)">ìµœê·¼ 30íšŒ</button>
            <button class="tab-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-white/10 text-white/60 hover:bg-white/20" data-period="100" onclick="switchPeriod(100)">ìµœê·¼ 100íšŒ</button>
        </div>

        <!-- 45ë²ˆí˜¸ ê·¸ë¦¬ë“œ -->
        <div class="grid grid-cols-9 gap-1.5 max-w-sm mx-auto" id="number-grid">
            {% for num_data in number_stats.items %}
            <div class="num-cell aspect-square rounded-lg flex items-center justify-center text-xs font-bold cursor-pointer relative"
                 data-num="{{ num_data.0 }}"
                 data-freq10="{{ num_data.1.freq_10 }}"
                 data-freq30="{{ num_data.1.freq_30 }}"
                 data-freq100="{{ num_data.1.freq_100 }}"
                 data-freqtotal="{{ num_data.1.freq_total }}"
                 title="{{ num_data.0 }}ë²ˆ: {{ num_data.1.freq_10 }}íšŒ ì¶œí˜„">
                <span class="relative z-10">{{ num_data.0 }}</span>
            </div>
            {% endfor %}
        </div>

        <p class="text-center text-white/30 text-xs mt-4">ë²ˆí˜¸ë¥¼ íƒ­í•˜ë©´ ìƒì„¸ í†µê³„ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 4: 3ë‹¨ê³„ ì„œë¹„ìŠ¤ êµ¬ì¡° (í•µì‹¬)          -->
<!-- ============================================ -->
<section id="service" class="py-16 px-4 bg-gradient-to-b from-lotto-blue-dark to-gray-950">
    <div class="max-w-5xl mx-auto section-fade">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold">3ë‹¨ê³„ ì„œë¹„ìŠ¤ êµ¬ì¡°</h2>
            <p class="text-white/40 text-sm mt-1">ë¡œë˜ì˜ ëª¨ë“  ê²ƒ, L7*7ì—ì„œ</p>
        </div>

        <!-- ìˆ˜í‰ ìŠ¤í¬ë¡¤ (ëª¨ë°”ì¼) / 3ì»¬ëŸ¼ ê·¸ë¦¬ë“œ (ë°ìŠ¤í¬í†±) -->
        <div class="flex gap-4 overflow-x-auto snap-x snap-mandatory pb-4 -mx-4 px-4 md:grid md:grid-cols-3 md:overflow-visible md:mx-0 md:px-0 scrollbar-hide">
            {% for stage in service_stages %}
            <div class="stage-card min-w-[85vw] md:min-w-0 snap-center flex-shrink-0 rounded-2xl p-6 bg-gradient-to-br {{ stage.gradient }} border border-white/15 shadow-2xl relative overflow-hidden">
                <!-- ìŠ¤í…Œì´ì§€ ë²ˆí˜¸ ì›Œí„°ë§ˆí¬ -->
                <div class="absolute top-4 right-4 text-8xl font-black text-white/5 leading-none">
                    0{{ stage.stage }}
                </div>

                <div class="relative z-10">
                    <!-- ì•„ì´ì½˜ & ì œëª© -->
                    <div class="text-5xl mb-4">{{ stage.icon }}</div>
                    <div class="inline-block px-3 py-0.5 rounded-full bg-white/15 text-[10px] text-white/70 mb-2">
                        STAGE {{ stage.stage }}
                    </div>
                    <h3 class="text-xl font-bold mb-1">{{ stage.title }}</h3>
                    <p class="text-white/60 text-sm mb-5">{{ stage.subtitle }}</p>

                    <!-- ê¸°ëŠ¥ ë¦¬ìŠ¤íŠ¸ -->
                    <ul class="space-y-3">
                        {% for feature in stage.features %}
                        <li class="flex items-start gap-2.5">
                            <svg class="w-5 h-5 text-lotto-gold-light flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            <div>
                                <span class="text-sm font-medium">{{ feature.text }}</span>
                                <span class="text-xs text-white/40 block">{{ feature.desc }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ìŠ¤í¬ë¡¤ ì¸ë””ì¼€ì´í„° (ëª¨ë°”ì¼ë§Œ) -->
        <div class="flex justify-center gap-2 mt-4 md:hidden">
            <span class="stage-dot w-2 h-2 rounded-full bg-lotto-gold transition-all"></span>
            <span class="stage-dot w-2 h-2 rounded-full bg-white/30 transition-all"></span>
            <span class="stage-dot w-2 h-2 rounded-full bg-white/30 transition-all"></span>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 5: í–‰ìš´ì˜ ëª…ë‹¹ íŒë§¤ì                 -->
<!-- ============================================ -->
<section id="stores" class="py-16 px-4 bg-gray-950">
    <div class="max-w-lg mx-auto section-fade">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold">ğŸ† í–‰ìš´ì˜ ëª…ë‹¹ íŒë§¤ì </h2>
            <p class="text-white/40 text-sm mt-1">ì „êµ­ 1ë“± ë‹¹ì²¨ ìµœë‹¤ ë°°ì¶œì </p>
        </div>

        <div class="space-y-3">
            {% for store in lucky_stores %}
            <div class="glass-card rounded-xl p-4 flex items-center gap-4">
                <!-- ìˆœìœ„ -->
                <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm flex-shrink-0
                    {% if store.rank == 1 %}bg-lotto-gold text-lotto-blue-dark{% elif store.rank == 2 %}bg-gray-300 text-gray-700{% elif store.rank == 3 %}bg-amber-700 text-white{% else %}bg-white/10 text-white/60{% endif %}">
                    {{ store.rank }}
                </div>

                <!-- ì •ë³´ -->
                <div class="flex-1 min-w-0">
                    <h4 class="font-semibold text-sm truncate">{{ store.name }}</h4>
                    <p class="text-white/40 text-xs truncate">{{ store.address }}</p>
                </div>

                <!-- í†µê³„ -->
                <div class="text-right flex-shrink-0">
                    <div class="text-lotto-gold font-bold text-sm">{{ store.total_winners }}ëª…</div>
                    <div class="text-white/30 text-[10px]">1ë“± ë‹¹ì²¨</div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-6">
            <a href="https://www.dhlottery.co.kr/prchsplcsrch/home" target="_blank" rel="noopener"
               class="inline-block px-6 py-2.5 bg-white/10 border border-white/20 rounded-full text-sm text-white/60 hover:bg-white/20 hover:text-white transition-all">
                ğŸ—ºï¸ ë™í–‰ë³µê¶Œ ë‹¹ì²¨ íŒë§¤ì  ì¡°íšŒ
            </a>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 6: íšŒì› ë“±ê¸‰ ì‹œìŠ¤í…œ                  -->
<!-- ============================================ -->
<section id="levels" class="py-16 px-4 bg-gradient-to-b from-gray-950 to-lotto-blue-dark">
    <div class="max-w-lg mx-auto section-fade">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold">ë ˆë²¨ & ë¦¬ì›Œë“œ</h2>
            <p class="text-white/40 text-sm mt-1">í™œë™í• ìˆ˜ë¡ í˜œíƒì´ ì»¤ì§‘ë‹ˆë‹¤</p>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            {% for level in user_levels %}
            <div class="glass-card rounded-xl p-4 text-center hover:border-lotto-gold/30 transition-all {% if forloop.first %}ring-1 ring-lotto-gold/30{% endif %}">
                <div class="text-4xl mb-2">{{ level.icon }}</div>
                <h4 class="font-bold text-sm" style="color: {{ level.color }};">{{ level.name }}</h4>
                <p class="text-white/40 text-xs mt-1">{{ level.requirement }}</p>
                <div class="mt-3 pt-3 border-t border-white/5">
                    <p class="text-white/50 text-[10px]">{{ level.benefit }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 7: ì˜¤ëŠ˜ì˜ ì½˜í…ì¸                      -->
<!-- ============================================ -->
<section id="daily" class="py-16 px-4 bg-lotto-blue-dark">
    <div class="max-w-lg mx-auto section-fade">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold">ì˜¤ëŠ˜ì˜ í–‰ìš´</h2>
            <p class="text-white/40 text-sm mt-1">ë§¤ì¼ ë°”ë€ŒëŠ” í–‰ìš´ì˜ ë©”ì‹œì§€</p>
        </div>

        <!-- ì˜¤ëŠ˜ì˜ í–‰ìš´ë²ˆí˜¸ -->
        <div class="glass-card rounded-2xl p-6 mb-4">
            <h3 class="text-center text-sm text-white/50 mb-4">ğŸ± ì˜¤ëŠ˜ì˜ í–‰ìš´ ë²ˆí˜¸</h3>
            <div class="flex justify-center gap-2.5" id="daily-numbers">
                {% for num in daily_numbers %}
                <div class="flip-card w-11 h-11" style="animation-delay: {{ forloop.counter0 }}00ms;">
                    <div class="flip-card-inner w-full h-full relative">
                        <!-- ì•ë©´ (ë¬¼ìŒí‘œ) -->
                        <div class="flip-card-front rounded-full bg-white/10 text-white/30 font-bold text-lg">?</div>
                        <!-- ë’·ë©´ (ë²ˆí˜¸) -->
                        <div class="flip-card-back rounded-full font-bold text-sm shadow-md"
                             style="background: {{ num|ball_color }}; color: {{ num|ball_text_color }};">
                            {{ num }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button onclick="revealDailyNumbers()" id="reveal-btn" class="block mx-auto mt-4 px-6 py-2 bg-lotto-gold/20 text-lotto-gold text-sm rounded-full hover:bg-lotto-gold/30 transition-colors">
                í„°ì¹˜í•˜ì—¬ ë²ˆí˜¸ í™•ì¸
            </button>
        </div>

        <!-- í–‰ìš´ì˜ í•œë§ˆë”” -->
        <div class="glass-card rounded-2xl p-6 text-center">
            <div class="text-3xl mb-3">ğŸ€</div>
            <p class="text-lg font-medium text-white/80 italic">"{{ daily_quote }}"</p>
            <p class="text-white/30 text-xs mt-3">â€” ì˜¤ëŠ˜ì˜ í–‰ìš´ ë©”ì‹œì§€</p>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 7.5: ì‚¬ì£¼íŒ”ì CTA                    -->
<!-- ============================================ -->
<section id="saju-cta" class="py-16 px-4 bg-gradient-to-b from-lotto-blue-dark to-indigo-950/50">
    <div class="max-w-lg mx-auto section-fade">
        <div class="bg-gradient-to-br from-indigo-900/80 to-purple-900/80 rounded-3xl p-8 border border-purple-500/20 text-center relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-indigo-500/10 rounded-full blur-2xl"></div>
            <div class="relative z-10">
                <div class="text-5xl mb-4">ğŸ§¿</div>
                <h2 class="text-2xl font-bold mb-2">ë‚˜ë§Œì˜ í–‰ìš´ë²ˆí˜¸</h2>
                <p class="text-white/60 text-sm mb-6 leading-relaxed">
                    ì‚¬ì£¼íŒ”ìë¥¼ AIê°€ ë¶„ì„í•˜ì—¬<br>
                    ë‚˜ì—ê²Œ ë”± ë§ëŠ” ë¡œë˜ ë²ˆí˜¸ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤
                </p>
                <a href="/saju/" class="inline-block px-8 py-3.5 bg-lotto-gold text-lotto-blue-dark font-bold rounded-full text-lg shadow-lg shadow-lotto-gold/30 hover:bg-lotto-gold-light transition-all hover:scale-105 active:scale-95">
                    ë¬´ë£Œë¡œ í™•ì¸í•˜ê¸°
                </a>
                <div class="flex justify-center gap-6 mt-6 text-xs text-white/30">
                    <span>ğŸ”’ ê°œì¸ì •ë³´ ë¯¸ì €ì¥</span>
                    <span>âš¡ 10ì´ˆ ë¶„ì„</span>
                    <span>ğŸ¯ AI ë§ì¶¤í˜•</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 8: ì»¤ë®¤ë‹ˆí‹° ë¯¸ë¦¬ë³´ê¸°                 -->
<!-- ============================================ -->
<section id="community" class="py-16 px-4 bg-gradient-to-b from-lotto-blue-dark to-gray-950">
    <div class="max-w-lg mx-auto section-fade">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold">ì»¤ë®¤ë‹ˆí‹°</h2>
            <p class="text-white/40 text-sm mt-1">í•¨ê»˜í•˜ë©´ í–‰ìš´ë„ ì»¤ì§‘ë‹ˆë‹¤</p>
        </div>

        <!-- ì¸ê¸° ê²Œì‹œê¸€ -->
        <div class="space-y-3 mb-6">
            {% for post in community_posts %}
            <div class="glass-card rounded-xl p-4 hover:border-white/20 transition-all cursor-pointer">
                <div class="flex items-start gap-3">
                    <!-- ì¹´í…Œê³ ë¦¬ ë±ƒì§€ -->
                    <span class="flex-shrink-0 px-2 py-0.5 rounded text-[10px] font-semibold
                        {% if post.category == 'story' %}bg-green-500/20 text-green-400
                        {% elif post.category == 'group' %}bg-blue-500/20 text-blue-400
                        {% else %}bg-purple-500/20 text-purple-400{% endif %}">
                        {% if post.category == 'story' %}í›„ê¸°{% elif post.category == 'group' %}ëª¨ì§‘{% else %}ë¶„ì„{% endif %}
                    </span>
                    <div class="flex-1 min-w-0">
                        <h4 class="text-sm font-medium truncate">{{ post.title }}</h4>
                        <div class="flex items-center gap-3 mt-1.5 text-white/30 text-xs">
                            <span>{{ post.author }}</span>
                            <span>ğŸ‘ {{ post.views|intcomma_kr }}</span>
                            <span>ğŸ’¬ {{ post.comments }}</span>
                            <span>{{ post.time_ago }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ê³µë™êµ¬ë§¤ ëª¨ì„ í‹°ì € -->
        <div class="bg-gradient-to-r from-blue-800/50 to-indigo-900/50 rounded-2xl p-6 border border-blue-500/20 text-center">
            <div class="text-3xl mb-2">ğŸ¤</div>
            <h3 class="font-bold">ê³µë™êµ¬ë§¤ ëª¨ì„</h3>
            <p class="text-white/50 text-sm mt-1 mb-4">ì†Œì•¡ìœ¼ë¡œ ë‹¤ì–‘í•œ ì¡°í•©ì„ êµ¬ë§¤í•˜ì„¸ìš”</p>
            <div class="flex justify-center gap-4 mb-4 text-sm">
                <div>
                    <div class="text-2xl font-bold text-lotto-gold">24</div>
                    <div class="text-white/30 text-xs">í™œì„± ëª¨ì„</div>
                </div>
                <div class="w-px bg-white/10"></div>
                <div>
                    <div class="text-2xl font-bold text-lotto-gold">187</div>
                    <div class="text-white/30 text-xs">ì°¸ì—¬ íšŒì›</div>
                </div>
                <div class="w-px bg-white/10"></div>
                <div>
                    <div class="text-2xl font-bold text-lotto-gold">12</div>
                    <div class="text-white/30 text-xs">ë‹¹ì²¨ ëª¨ì„</div>
                </div>
            </div>
            <a href="#" class="inline-block px-6 py-2.5 bg-lotto-gold text-lotto-blue-dark font-semibold rounded-full text-sm hover:bg-lotto-gold-light transition-colors">
                ëª¨ì„ ì°¸ì—¬í•˜ê¸°
            </a>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!-- SECTION 9: OMR ì¸ì‡„ ì„œë¹„ìŠ¤ (CTA)             -->
<!-- ============================================ -->
<section id="omr" class="py-16 px-4 bg-gray-950">
    <div class="max-w-lg mx-auto section-fade text-center">
        <div class="bg-gradient-to-br from-lotto-purple to-lotto-blue rounded-3xl p-8 border border-white/10 shadow-2xl relative overflow-hidden">
            <!-- ë°°ê²½ ì¥ì‹ -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-lotto-gold/10 rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-lotto-purple-light/10 rounded-full blur-2xl"></div>

            <div class="relative z-10">
                <div class="text-4xl mb-4">ğŸ–¨ï¸</div>
                <h2 class="text-2xl font-bold mb-2">OMR ì¸ì‡„ ëŒ€í–‰</h2>
                <p class="text-white/60 text-sm mb-6">
                    ì›¹ì—ì„œ ë²ˆí˜¸ ì„ íƒ â†’ ì¸ì‡„ëœ OMR ìš©ì§€ ìˆ˜ë ¹ â†’ íŒë§¤ì ì—ì„œ ë°”ë¡œ ì œì¶œ
                </p>

                <div class="grid grid-cols-3 gap-3 mb-6">
                    <div class="bg-white/10 rounded-xl p-3">
                        <div class="text-lg font-bold text-lotto-gold">500ì›</div>
                        <div class="text-[10px] text-white/40">1ì¥</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-3">
                        <div class="text-lg font-bold text-lotto-gold">2,000ì›</div>
                        <div class="text-[10px] text-white/40">5ì¥ (20% í• ì¸)</div>
                    </div>
                    <div class="bg-white/10 rounded-xl p-3">
                        <div class="text-lg font-bold text-lotto-gold">3,500ì›</div>
                        <div class="text-[10px] text-white/40">10ì¥ (30% í• ì¸)</div>
                    </div>
                </div>

                <a href="#" class="inline-block px-8 py-3 bg-lotto-gold text-lotto-blue-dark font-bold rounded-full text-lg hover:bg-lotto-gold-light transition-all hover:scale-105 active:scale-95">
                    ì§€ê¸ˆ ì£¼ë¬¸í•˜ê¸°
                </a>
                <p class="text-white/30 text-xs mt-3">ì¤€ë¹„ ì¤‘ &middot; ì„œë¹„ìŠ¤ ì˜¤í”ˆ ì‹œ ì•Œë¦¼ ë°›ê¸°</p>
            </div>
        </div>
    </div>
</section>

<!-- ë²ˆí˜¸ ìƒì„¸ í†µê³„ ëª¨ë‹¬ -->
<div id="number-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm px-4" onclick="if(event.target===this)closeNumberModal()">
    <div class="glass-card rounded-2xl p-6 max-w-sm w-full relative" style="background: rgba(15,23,42,0.95); border: 1px solid rgba(255,255,255,0.15);">
        <button onclick="closeNumberModal()" class="absolute top-3 right-3 text-white/40 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        <div id="modal-content">
            <div class="text-center py-8"><div class="text-white/40">ë¡œë”© ì¤‘...</div></div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// ============================================
// ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ (ë‹¤ìŒ í† ìš”ì¼ 20:45 KST - ë™í–‰ë³µê¶Œ ë™ê¸°í™”)
// ============================================
function updateCountdown() {
    const now = new Date();
    // Intl APIë¡œ ì •í™•í•œ KST ì‹œê°„ ê³„ì‚°
    const kst = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Seoul' }));

    let daysUntilSat = (6 - kst.getDay() + 7) % 7;
    if (daysUntilSat === 0 && (kst.getHours() > 20 || (kst.getHours() === 20 && kst.getMinutes() >= 45))) {
        daysUntilSat = 7;
    }

    // KST ê³µê°„ì—ì„œ ëª©í‘œ ì‹œê°„ ê³„ì‚°
    const target = new Date(kst);
    target.setDate(target.getDate() + daysUntilSat);
    target.setHours(20, 45, 0, 0);

    // KST ê³µê°„ì—ì„œì˜ ì°¨ì´ = ì‹¤ì œ ë‚¨ì€ ì‹œê°„ (ì‹œê°„ëŒ€ ë¬´ê´€)
    const diff = target - kst;

    if (diff <= 0) {
        document.getElementById('cd-days').textContent = '0';
        document.getElementById('cd-hours').textContent = '00';
        document.getElementById('cd-minutes').textContent = '00';
        document.getElementById('cd-seconds').textContent = '00';
        return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    document.getElementById('cd-days').textContent = days;
    document.getElementById('cd-hours').textContent = String(hours).padStart(2, '0');
    document.getElementById('cd-minutes').textContent = String(minutes).padStart(2, '0');
    document.getElementById('cd-seconds').textContent = String(seconds).padStart(2, '0');
}
updateCountdown();
setInterval(updateCountdown, 1000);

// ============================================
// ì„¹ì…˜ í˜ì´ë“œì¸ (Intersection Observer)
// ============================================
const fadeElements = document.querySelectorAll('.section-fade');
const fadeObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('visible');
        }
    });
}, { threshold: 0.1 });
fadeElements.forEach(el => fadeObserver.observe(el));

// ============================================
// 3ë‹¨ê³„ ì¹´ë“œ ìŠ¤í¬ë¡¤ ì¸ë””ì¼€ì´í„°
// ============================================
const stageCards = document.querySelectorAll('.stage-card');
const stageDots = document.querySelectorAll('.stage-dot');

if (stageCards.length && stageDots.length) {
    const stageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const index = [...stageCards].indexOf(entry.target);
                stageDots.forEach((dot, i) => {
                    dot.classList.toggle('bg-lotto-gold', i === index);
                    dot.classList.toggle('bg-white/30', i !== index);
                });
            }
        });
    }, { threshold: 0.6 });
    stageCards.forEach(card => stageObserver.observe(card));
}

// ============================================
// ë²ˆí˜¸ ê·¸ë¦¬ë“œ - ê¸°ê°„ë³„ ì „í™˜
// ============================================
function getHeatColor(freq, maxFreq) {
    const ratio = Math.min(freq / maxFreq, 1.0);
    if (ratio > 0.6) {
        return `rgba(239, 68, 68, ${0.3 + ratio * 0.5})`;
    } else if (ratio > 0.3) {
        return `rgba(234, 179, 8, ${0.3 + ratio * 0.4})`;
    } else {
        return `rgba(59, 130, 246, ${0.3 + ratio * 0.4})`;
    }
}

function switchPeriod(period) {
    // íƒ­ ìŠ¤íƒ€ì¼ ë³€ê²½
    document.querySelectorAll('.tab-btn').forEach(btn => {
        if (parseInt(btn.dataset.period) === period) {
            btn.className = 'tab-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-lotto-gold text-lotto-blue-dark';
        } else {
            btn.className = 'tab-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-white/10 text-white/60 hover:bg-white/20';
        }
    });

    // ê·¸ë¦¬ë“œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
    const maxFreqs = { 10: 4, 30: 9, 100: 23 };
    const maxFreq = maxFreqs[period] || 4;

    document.querySelectorAll('.num-cell').forEach(cell => {
        const freq = parseInt(cell.dataset[`freq${period}`]) || 0;
        cell.style.background = getHeatColor(freq, maxFreq);
        cell.title = `${cell.dataset.num}ë²ˆ: ${freq}íšŒ ì¶œí˜„`;
    });
}

// ì´ˆê¸° ê·¸ë¦¬ë“œ ìƒ‰ìƒ ì„¤ì •
switchPeriod(10);

// ============================================
// ë²ˆí˜¸ ìƒì„¸ í†µê³„ ëª¨ë‹¬
// ============================================
const BALL_COLORS = {1:'#FFC107',11:'#2196F3',21:'#F44336',31:'#9E9E9E',41:'#4CAF50'};
function getBallColor(n) {
    if (n <= 10) return BALL_COLORS[1];
    if (n <= 20) return BALL_COLORS[11];
    if (n <= 30) return BALL_COLORS[21];
    if (n <= 40) return BALL_COLORS[31];
    return BALL_COLORS[41];
}
function getBallTextColor(n) { return n <= 10 ? '#333' : '#fff'; }

document.querySelectorAll('.num-cell').forEach(cell => {
    cell.style.cursor = 'pointer';
    cell.addEventListener('click', () => openNumberModal(parseInt(cell.dataset.num)));
});

async function openNumberModal(num) {
    const modal = document.getElementById('number-modal');
    const content = document.getElementById('modal-content');
    content.innerHTML = '<div class="text-center py-8"><div class="text-white/40 text-sm">ë¡œë”© ì¤‘...</div></div>';
    modal.classList.remove('hidden');
    modal.classList.add('flex');

    try {
        const res = await fetch(`/api/number/${num}/stats/`);
        const d = await res.json();
        const trendIcon = d.trend === 'increasing' ? 'ğŸ“ˆ ìƒìŠ¹' : d.trend === 'decreasing' ? 'ğŸ“‰ í•˜ë½' : 'â¡ï¸ ìœ ì§€';
        const coHtml = d.co_occurrence.map(c =>
            `<div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold shadow" style="background:${getBallColor(c.number)};color:${getBallTextColor(c.number)};" title="${c.count}íšŒ">${c.number}</div>`
        ).join('');

        content.innerHTML = `
            <div class="text-center mb-4">
                <div class="w-14 h-14 rounded-full flex items-center justify-center text-xl font-bold shadow-lg mx-auto mb-2"
                     style="background:${getBallColor(num)};color:${getBallTextColor(num)};">${num}</div>
                <div class="text-lg font-bold">${num}ë²ˆ ìƒì„¸ í†µê³„</div>
            </div>
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-white/5 rounded-xl p-3 text-center">
                    <div class="text-xl font-bold text-lotto-gold">${d.total_appearances}</div>
                    <div class="text-[10px] text-white/40">ì „ì²´ ì¶œí˜„ / ${d.total_draws}íšŒ</div>
                </div>
                <div class="bg-white/5 rounded-xl p-3 text-center">
                    <div class="text-xl font-bold text-white">${trendIcon}</div>
                    <div class="text-[10px] text-white/40">ìµœê·¼ íŠ¸ë Œë“œ</div>
                </div>
            </div>
            <div class="space-y-2 mb-4">
                <div class="flex justify-between items-center text-sm">
                    <span class="text-white/50">ìµœê·¼ 10íšŒ</span>
                    <div class="flex items-center gap-2">
                        <div class="w-24 h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full rounded-full bg-lotto-gold" style="width:${d.last_10/4*100}%"></div>
                        </div>
                        <span class="font-bold text-lotto-gold w-8 text-right">${d.last_10}</span>
                    </div>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-white/50">ìµœê·¼ 30íšŒ</span>
                    <div class="flex items-center gap-2">
                        <div class="w-24 h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full rounded-full bg-blue-400" style="width:${d.last_30/9*100}%"></div>
                        </div>
                        <span class="font-bold text-blue-400 w-8 text-right">${d.last_30}</span>
                    </div>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-white/50">ìµœê·¼ 100íšŒ</span>
                    <div class="flex items-center gap-2">
                        <div class="w-24 h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full rounded-full bg-purple-400" style="width:${d.last_100/23*100}%"></div>
                        </div>
                        <span class="font-bold text-purple-400 w-8 text-right">${d.last_100}</span>
                    </div>
                </div>
            </div>
            ${d.last_draw_no ? `<div class="text-xs text-white/40 mb-4">ë§ˆì§€ë§‰ ì¶œí˜„: ì œ${d.last_draw_no}íšŒ (${d.last_draw_date})</div>` : ''}
            <div>
                <div class="text-xs text-white/50 mb-2">ìì£¼ í•¨ê»˜ ë‚˜ì˜¤ëŠ” ë²ˆí˜¸</div>
                <div class="flex gap-2 justify-center">${coHtml}</div>
            </div>
        `;
    } catch(e) {
        content.innerHTML = '<div class="text-center py-8 text-red-400 text-sm">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
    }
}

function closeNumberModal() {
    const modal = document.getElementById('number-modal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}

// ============================================
// ì˜¤ëŠ˜ì˜ í–‰ìš´ë²ˆí˜¸ í”Œë¦½
// ============================================
function revealDailyNumbers() {
    const cards = document.querySelectorAll('.flip-card');
    cards.forEach((card, i) => {
        setTimeout(() => card.classList.add('revealed'), i * 200);
    });
    document.getElementById('reveal-btn').style.display = 'none';
}
</script>
{% endblock %}
